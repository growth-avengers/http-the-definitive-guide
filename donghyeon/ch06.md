# ch06. 프락시

- 클라이언트와 서버 사이에서 중개자 역할
- 게이트웨이와의 차이
	- 프락시: 같은 프로토콜을 사용하는 둘 이상을 연결
	- 게이트웨이: 서로 다른 프로토콜을 사용하는 둘 이상을 연결
	- 프락시는 프로토콜을 변환하기도 하기 때문에 실제로 차이점은 모호
- 사용 이유: 보안, 성능, 비용, 트래픽 감시 및 수정 등
- 프락시 종류
	- 필터링 프락시
	- 접근 제어 프락시
	- 보안 방화벽
	- 웹 캐시
	- 대리(리버스) 프락시: 서버 가속기
	- 콘텐츠 라우터
	- 트랜스코더: 본문 포맷 수정(확장자 변환, 텍스트 언어 변환 등)
	- 익명화 프락시(Anonymizer): HTTP 메시지에서 신원을 식별할 수 있는 IP 주소, From 헤더, 쿠키 등을 제거해 개인 정보 보호와 익명성 보장
- 프락시 서버 배치
	- 출구(Egress) 프락시: 로컬 네트워크의 출구. 방화벽, 필터링 프락시
	- 입구(입구) 프락시: ISP 접근 지점에 위치.
	- 대리 프락시: 웹 서버의 바로 앞. 성능 개선, 보안 기능 추가 등
	- 네트워크 교환 프락시: 인터넷 피어링 교환 지점. 캐시
- 프락시 동작 방법
	- 클라이언트 수정
	- 네트워크 수정(인터넵트 프락시)
	- DNS 이름공간 수정
	- 웹 서버 수정
- 브라우저는 프락시의 존재 여부에 따라 요청 URI를 다르게 분석
	- 프락시 X
		1. 사용자가 브라우저 URI에 'oreilly' 입력
		2. 브라우저는 'oreilly'를 호스트 명으로 사용하고 기본 스킴을 'http://', 기본 포트를 '80', 기본 경로를 '/'로 간주
		3. DNS에서 호스트 'oreilly'를 찾음
		4. 실패하면 브라우저는 호스트 명을 자동으로 확장하여 DNS에 '`www.oreilly.com`'의 주소 분해 요청하여 성공
		5. '`www.oreilly.com`'로 연결 성공
	- 명시적 프락시: 프락시 요청은 완전한 URI를 갖춤. 부분 호스트 명을 자동확장하지 않음
		1. 사용자가 브라우저 URI에 'oreilly' 입력
		2. 브라우저는 기본 스킴, 경로는 추가하지만 호스트 명은 입력한 대로 남겨 둔다. (`http://oreilly/`)
	- 인터셉트 프락시: 클라이언트는 프락시의 존재를 모르기 때문에 부분 URI를 받음
		1. 기본적으로 프락시가 없을 때와 동작이 같음. 서버로의 커넥션이 만들어 졌을 때부터 차이가 생김
		2. DNS에서 받은 IP 주소의 목록으로 연결 시도
			- 일반적인 경우: 성공할 때까지 모든 IP 주소에 대해 접속 시도
			- 인터셉트 프락시: 접속이 실패하면 프락시에 의해 연결이 종료되어 클라이언트는 접속이 성공한 줄 암
- 프락시 캐시
	- Via 헤더: 메시지가 지나가는 각 중간 노드의 정보를 나열
	- TRACE 메서드: 프락시 흐름을 디버깅하는데 유용
