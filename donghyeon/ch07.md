# ch07. 캐시

- 웹 캐시: 자주 쓰이는 문서의 사본을 자동으로 보관하는 HTTP 장치
  - 장점
    - 불필요한 데이터 전송을 줄여 네트워크 비용 감소
    - 네트워크 병목을 줄여 대역폭을 늘리지 않고도 빠른 속도 유지
    - 원 서버의 부하 감소
    - 거리로 인한 응답 지연 감소
  - 적중과 부적중
    - 캐시 적중(cache hit): 요청에 대응하는 사본이 있어 캐시 자료를 응답
    - 캐시 부적중(cache miss): 요청에 대응하는 사본이 없어 원 서버에 요청
  - 재검사(Revalidation): 캐시 사본이 최신 데이터인지 검증(신선도 검사)
    - 클라이언트의 요청이 있으며, 사본이 오래된 경우에 재검사를 실시
    - 원 서버에 재검사 요청을 보내서 콘텐츠가 신선하면 304 응답을 받음
    - 사본이 유효하다면 사본이 신선하다고 표시하고 클라이언트에 제공
    - 이를 재검사 적중 혹은 느린 적중이라고 한다.
    - 이는 캐시 부적중보다는 빠른데 데이터를 새로 받아올 필요가 없기 때문
  - 적중률
    - 캐시가 요청을 처리하는 비율을 캐시 적중률이라고 함
    - 적중률은 0 ~ 1 까지의 값으로 흔히 퍼센트로 표현
    - 일반적으로 40%의 적중률이면 괜찮은 편
  - 바이트 적중률
    - 캐시 중에서도 크기가 큰 객체가 적중되는 것이 전체 트래픽에 더 크게 기여
    - 캐시를 통해 제공된 모든 바이트의 비율을 바이트 적중률이라 함
    - 트래픽이 절감된 정도를 포착할 수 있음
- 캐시 토폴로지
  - 개인 전용 캐시(private cache)
    - 한 명에게만 할당된 캐시
    - 웹 브라우저에서 사용
  - 공용 캐시(public cache)
    - 프락시 캐시라 불리는 프락시 서버
- 캐시 처리 단계
  1. 요청 받고 메시지 파싱
  2. 검색: 로컬 복사본이 있는지 검사하고, 사본이 없다면 사본을 받아 로컬에 저장
  3. 신선도 검사: 캐시된 사본이 충분히 신선한지 검사하고 신선하지 않다면 재검사
  4. 응답 생성 및 발송
  5. 로깅: 로그파일에 트랜잭션에 대한 로그를 남김(선택적인 단계)
- 캐시 신선도
  - HTTP 헤더를 통해 유효기간 설정
    - Cache-Control: max-age
    - Expires
